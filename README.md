# Эмулятор процессора

## Устройство эмулятора

При помощи языка программирования `C`, реализован эмулятор процессора с некоторым набором команд. Процессор работает со стеком, оперативной памятью и четырьмя регистрами: `rax`, `rbx`, `rcx`, `rdx`.

## Поддерживаемые команды

1) **Работа со стеком** <br />
    - `push {число}` - положить число в стек.
    - `push` {регистр} - положить значение регистра в стек.
    - `pop {регистр}` - забрать число из вершины стека и положить его в регистр. <br />

2) **Работа с оперативной памятью** <br />
    - `push [{индекс}]` - положить в стек число, лежащее в оперативной памяти по указанному индексу.
    - `pop [{индекс}]` - забрать число из вершины стека и положить его в оперативную память по указанному индексу.
    - `push [{регистр}]` - положить в стек число, лежащее в оперативной памяти по индексу, полученному из регистра.
    - `pop [{регистр}]` - забрать число из вершины стека и положить его в оперативную память по индексу, полученному из регистра. <br />

3) **Арифметические операции** <br />
    Все операции берут необходимое количество аргументов из стека, производят необходимые действия и помещают результат обратно в стек. В случае двух аргументов первый аргумент - число на вершине стека. <br />
    Обозначения: arg1 - первый аргумент, arg2 - второй аргумент. <br />
    - `add` : arg1 + arg2.
    - `sub` : arg1 - arg2.
    - `mul` : arg1 * arg2.
    - `div` : arg1 / arg2.
    - `sqrt` : $\sqrt{arg1}$.
    - `sqrt` : $sqrt {arg1}$.
    - `sin` : sin(arg1).
    - `cos` : cos(arg1).
    - `pow` : $arg1^{arg2}.$

4) **Условные и безусловные переходы** <br />
    Условные переходы берут аргументы из стека. Порядок аргументов тот же, что и для арифметических операций. <br \>
    - `jmp {метка}` - безусловный переход
    - `je {метка}` - переход при условии arg1 == arg2.
    - `jb {метка}` - переход при условии arg1 < arg2.
    - `ja {метка}` - переход при условии arg1 > arg2.
    - `jbe {метка}` - переход при условии arg1 <= arg2.
    - `jae {метка}` - переход при условии arg1 >= arg2.
    - `jm {метка}` - переход при условии, что сегодня понедельник.

5) **Команды ввода вывода**
    - `in` - ожидает ввода числа с клавиатуры и помещает полученное значение в стек.
    - `out` - берет число с вершины стека и выводит его на экран.
    - `outc` - берет число с вершины стека и выводит символ с соответствующим ASCII кодом.
    - `ramout` - печатает все символы из оперативной памяти, начиная с ячейки с индексом 0.

6) **Функции**
    - `call {метка}` - вызов функции.
    - `ret` - возврат из функции.

7) **Завершение программы**
    - `hlt` - завершение всей программы.

> [!NOTE]
> 1) Метки объявляются в начале строки следующим образом - `:{имя_метки}`.
> 2) Строки, начинающиеся с `;`, считаются комментариями.

## Конфигурация процессора

В файле [configurations.h](src/configuration.h) можно настраивать эмулятор.

- `#define logs_file {имя файла}` - определить файл, куда будут выводится сообщения об ошибках при работе стека. Значение по умолчанию - `stdout`.
- `#define PROTECT` - активировать защиту стека.
- `typedef {тип_данных} Elem_t` - указать тип данных, с которым будет работать процессор. Для выбранного типа нужно ниже при помощи `#define output_id "{формат}"` определить формат для `printf` и `scanf`.
- `const int RAM_SIZE = {размер_оперативной памяти}` - можно указать размер оперативной памяти.
- `const int PRECISION = {точность}` - определить кол-во значимых цифр после запятой для арифметических операций. При увеличении этого параметра размер максимального значения, с которым может работать процессор, уменьшается.

## Сборка и использование

### Сборка

**Клонируйте репозиторий и переходите в папку с ним**

```sh
    git clone https://github.com/1progwriter1/Processor.git && cd Processor
```

**Соберите исходники**

```sh
    make asm && make proc && make disasm
```

### Использование

1) `./asm.out {входной_файл} {исполняемый_файл}` - создать бинарный исполняемый файл для процессора.
2) `./proc.out {исполняемый файл}` - запустить процессор.
3) `./disasm.out {исполняемый_файл} {выходной файл}` - дизассемблировать исполняемый файл.
